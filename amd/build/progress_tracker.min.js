define("tool_bulkmessaging/progress_tracker",["exports","core/ajax","core/log"],(function(_exports,_ajax,_log){var obj;
/**
   * AJAX progress tracker for bulk messaging history page.
   *
   * @module     tool_bulkmessaging/progress_tracker
   * @copyright  2026 Moddaker
   * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init=void 0,_log=(obj=_log)&&obj.__esModule?obj:{default:obj};const TERMINAL_STATUSES=[2,3,4,5],getProgress=logid=>(0,_ajax.call)([{methodname:"tool_bulkmessaging_get_message_progress",args:{logid:logid}}])[0],updateRow=(logid,data)=>{const statusEl=document.getElementById("bmsg-status-"+logid);statusEl&&(statusEl.className=data.statusclass,statusEl.textContent=data.statuslabel);const progressEl=document.getElementById("bmsg-progress-"+logid);if(progressEl){const bar=progressEl.querySelector(".progress-bar");bar&&(bar.style.width=data.percentage+"%",bar.setAttribute("aria-valuenow",data.percentage));const countsEl=progressEl.querySelector(".bmsg-counts");if(countsEl){let text=data.sentcount.toString();data.failedcount>0&&(text+=" / "+data.failedcount+" failed"),text+=" ("+data.percentage+"%)",countsEl.textContent=text}if(0!==data.status){const progressWrap=progressEl.querySelector(".progress");progressWrap&&(progressWrap.style.display="");const countsWrap=progressEl.querySelector(".bmsg-counts");countsWrap&&(countsWrap.style.display="")}}const actionsEl=document.getElementById("bmsg-actions-"+logid);if(actionsEl){const cancelBtn=actionsEl.querySelector('[data-action="cancel"]');cancelBtn&&(cancelBtn.style.display=0===data.status?"":"none");const stopBtn=actionsEl.querySelector('[data-action="stop"]');stopBtn&&(stopBtn.style.display=1===data.status?"":"none");const startBtn=actionsEl.querySelector('[data-action="start"]');startBtn&&(startBtn.style.display=3===data.status||5===data.status?"":"none");const deleteBtn=actionsEl.querySelector('[data-action="delete"]');deleteBtn&&(deleteBtn.style.display=TERMINAL_STATUSES.includes(data.status)?"":"none")}};_exports.init=activeLogIds=>{activeLogIds&&0!==activeLogIds.length&&(logids=>{const activeIds=new Set(logids),poll=()=>{if(0===activeIds.size)return;const promises=[];for(const logid of activeIds)promises.push(getProgress(logid).then((data=>{updateRow(logid,data),TERMINAL_STATUSES.includes(data.status)&&activeIds.delete(logid)})).catch((err=>{_log.default.error("Progress tracker error for log "+logid+": "+err),activeIds.delete(logid)})));Promise.all(promises).then((()=>{activeIds.size>0&&setTimeout(poll,3e3)}))};setTimeout(poll,3e3)})(activeLogIds)}}));

//# sourceMappingURL=progress_tracker.min.js.map